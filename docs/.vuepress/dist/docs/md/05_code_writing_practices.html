<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Практики написания кода | Электронный учебник</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.e8e4f3a3.css" as="style"><link rel="preload" href="/assets/js/app.8d616f72.js" as="script"><link rel="preload" href="/assets/js/2.733019b2.js" as="script"><link rel="preload" href="/assets/js/13.402f33c0.js" as="script"><link rel="prefetch" href="/assets/js/10.b52bcba7.js"><link rel="prefetch" href="/assets/js/11.8c9498ce.js"><link rel="prefetch" href="/assets/js/12.0e5839ab.js"><link rel="prefetch" href="/assets/js/14.c3a933ba.js"><link rel="prefetch" href="/assets/js/15.c6688901.js"><link rel="prefetch" href="/assets/js/3.df158bf2.js"><link rel="prefetch" href="/assets/js/4.d12742be.js"><link rel="prefetch" href="/assets/js/5.216cae74.js"><link rel="prefetch" href="/assets/js/6.2d0a63f8.js"><link rel="prefetch" href="/assets/js/7.9c9172a7.js"><link rel="prefetch" href="/assets/js/8.dd542883.js"><link rel="prefetch" href="/assets/js/9.bdfaf367.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e8e4f3a3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Электронный учебник</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Практики написания кода</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/md/05_code_writing_practices.html#основы" class="sidebar-link">Основы</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/md/05_code_writing_practices.html#дата-и-время" class="sidebar-link">Дата и время</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/md/05_code_writing_practices.html#design-patterns" class="sidebar-link">Design Patterns</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/md/05_code_writing_practices.html#исключения" class="sidebar-link">Исключения</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/md/05_code_writing_practices.html#исключения-spl" class="sidebar-link">Исключения SPL</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="практики-написания-кода"><a href="#практики-написания-кода" class="header-anchor">#</a> Практики написания кода</h1> <h2 id="основы"><a href="#основы" class="header-anchor">#</a> Основы</h2> <p>PHP — это обширный язык, который позволяет разработчикам всех уровней писать код не только быстро, но и эффективно. В любом случае, изучая язык, мы нередко забываем основы, которые мы изучали изначально (или бегло просмотрели), в пользу коротких путей и/или вредных привычек. Чтобы помочь в борьбе с этой общей проблемой, эта секция предназначена для напоминания разработчикам основ практик написания кода PHP.</p> <h2 id="дата-и-время"><a href="#дата-и-время" class="header-anchor">#</a> Дата и время</h2> <p>PHP содержит встроенный класс DateTime, предназначенный для чтения, записи, сравнения и вычисления даты или времени. Также в PHP много функций, связанных с датой и временем, помимо класса DateTime, но класс предоставляет хороший объектно-ориентированный интерфейс для решения большинства задач. Он способен даже обрабатывать временные зоны, но это уже не рассматривается в данном коротком введении.</p> <p>Для начала работы с DateTime, сконвертируйте «сырую» строку даты и времени в объект с помощью фабричного метода <code>createFromFormat()</code> или выполните <code>new \DateTime</code>, чтобы получить текущую дату и время. Используйте метод <code>format()</code> для конвертирования DateTime обратно в строку для вывода.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$raw</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'22. 11. 1968'</span><span class="token punctuation">;</span>
<span class="token variable">$start</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>DateTime</span><span class="token operator">::</span><span class="token function">createFromFormat</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'d. m. Y'</span><span class="token punctuation">,</span> <span class="token variable">$raw</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">echo</span> <span class="token string single-quoted-string">'Start date: '</span> <span class="token operator">.</span> <span class="token variable">$start</span><span class="token operator">-&gt;</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'m/d/Y'</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;\n&quot;</span><span class="token punctuation">;</span>
</span></code></pre></div><p>Вычисления с DateTime возможны с использованием класса DateInterval. У класса DateTime есть методы <code>add()</code> и <code>sub()</code>, которые принимают DateInterval, как аргумент. Не пишите код, который ожидает одинаковое число секунд каждый день, перевод часов и смена часовых поясов разрушат это предположение. Вместо этого используйте интервалы дат. Для расчета разницы между датами используйте метод <code>diff()</code>. Он вернет новый объект DateInterval, который очень легко отобразить.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// создает копию $start и добавляет 1 месяц и 6 дней</span>
<span class="token variable">$end</span> <span class="token operator">=</span> <span class="token keyword">clone</span> <span class="token variable">$start</span><span class="token punctuation">;</span>
<span class="token variable">$end</span><span class="token operator">-&gt;</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DateInterval</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'P1M6D'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$diff</span> <span class="token operator">=</span> <span class="token variable">$end</span><span class="token operator">-&gt;</span><span class="token function">diff</span><span class="token punctuation">(</span><span class="token variable">$start</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'Difference: '</span> <span class="token operator">.</span> <span class="token variable">$diff</span><span class="token operator">-&gt;</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'%m месяц, %d дней (total: %a дней)'</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;\n&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// Разница : 1 месяц, 6 дней (всего : 37 дней)</span>
</span></code></pre></div><p>С объектами DateTime, вы можете использовать стандартные методы сравнения:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$start</span> <span class="token operator">&lt;</span> <span class="token variable">$end</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;Начальная дата раньше конечной!\n&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><p>И последний пример для демонстрации класса DatePeriod. Он используется для перебора повторяющихся событий. Класс может принимать два объекта DateTime, начало и конец, и интервал, для которого он вернет все события между ними.</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// выводит все четверги между началом и концом</span>
<span class="token variable">$periodInterval</span> <span class="token operator">=</span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>DateInterval</span><span class="token operator">::</span><span class="token function">createFromDateString</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'first thursday'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$periodIterator</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>DatePeriod</span><span class="token punctuation">(</span><span class="token variable">$start</span><span class="token punctuation">,</span> <span class="token variable">$periodInterval</span><span class="token punctuation">,</span> <span class="token variable">$end</span><span class="token punctuation">,</span> <span class="token class-name class-name-fully-qualified static-context"><span class="token punctuation">\</span>DatePeriod</span><span class="token operator">::</span><span class="token constant">EXCLUDE_START_DATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$periodIterator</span> <span class="token keyword">as</span> <span class="token variable">$date</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// вывести каждую дату в периоде</span>
    <span class="token keyword">echo</span> <span class="token variable">$date</span><span class="token operator">-&gt;</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'m/d/Y'</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">' '</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></code></pre></div><ul><li><a href="http://www.php.net/manual/ru/book.datetime.php" target="_blank" rel="noopener noreferrer">Подробнее о DateTime<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.php.net/manual/ru/function.date.php" target="_blank" rel="noopener noreferrer">Подробнее о форматировании даты<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (разрешенные опции строки формата даты)</li></ul> <h2 id="design-patterns"><a href="#design-patterns" class="header-anchor">#</a> Design Patterns</h2> <p>При построении приложения полезно использовать в коде шаблоны, а также придерживаться некоторых стандартов для всей структуры проекта. Использование шаблонов полезно, потому что оно упрощает управление кодом, а также позволяет другим разработчикам быстро понять, как всё взаимодействует друг с другом.</p> <p>Если вы используете фреймворк, то большинство высокоуровневого кода и структура проекта будет основываться на архитектуре фреймворка, поэтому большинство решений относительно шаблона сделано за вас. Но всё же наиболее верным решением будет выбрать наиболее подходящие шаблоны и следовать им в коде, который вы пишете на базе фреймворка. С другой стороны, если вы не используете фреймворк для построения приложения, тогда вы должны найти шаблоны, которые наилучшим образом соответствуют типу и размеру приложения, которое вы создаете.</p> <ul><li>Продолжить чтение <a href="/ru-php-the-right-way/pages/Шаблоны-проектирования.html">Шаблоны проектирования</a></li></ul> <h2 id="исключения"><a href="#исключения" class="header-anchor">#</a> Исключения</h2> <p>Исключения — это неотъемлемая часть большинства популярных языков программирования, но зачастую PHP разработчики не уделяют им должного внимания. Языки, подобные Ruby, очень подробно обрабатывают исключения, поэтому, если что-то идёт не верно, например: не удался HTTP запрос, запрос к базе данных происходит неправильно или если запрошенное изображение не было найдено, Ruby (или используемые гемы) выбросит исключение на экран, помогающее понять где вы допустили ошибку.</p> <p>PHP сам по себе довольно слаб в плане этого и вызов <code>file_get_contents()</code>, как правило, даст вам только <code>FALSE</code> и предупреждение. Многие устаревшие PHP-фреймворки, как CodeIgniter, просто вернут false, добавят сообщение в свой собственный журнал и, может быть, дадут вам использовать метод, как <code>$this-&gt;upload-&gt;get_error()</code>, чтобы посмотреть, что пошло не так. Проблема в том, что вы должны искать ошибку и проверять документацию, чтобы понять, какой ошибочный метод существует в этом классе, вместо того, чтобы сделать это всё более очевидным.</p> <p>Еще одна проблема в том, что классы автоматически выдают ошибку на экран и закрывают процесс. Когда вы делаете это, вы не даете другому разработчику динамически обработать эту ошибку. Исключения должны быть выброшены, чтобы дать разработчику знать об ошибке и выбрать, как её обработать. Например:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$email</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Fuel<span class="token punctuation">\</span>Email</span><span class="token punctuation">;</span>
<span class="token variable">$email</span><span class="token operator">-&gt;</span><span class="token function">subject</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'My Subject'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$email</span><span class="token operator">-&gt;</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'How the heck are you?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$email</span><span class="token operator">-&gt;</span><span class="token function">to</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'guy@example.com'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Some Guy'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span>
<span class="token punctuation">{</span>
    <span class="token variable">$email</span><span class="token operator">-&gt;</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified">Fuel<span class="token punctuation">\</span>Email<span class="token punctuation">\</span>ValidationFailedException</span> <span class="token variable">$e</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Валидация не удалась</span>
<span class="token punctuation">}</span>
<span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name class-name-fully-qualified">Fuel<span class="token punctuation">\</span>Email<span class="token punctuation">\</span>SendingFailedException</span> <span class="token variable">$e</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Драйвер не может отправить сообщение</span>
<span class="token punctuation">}</span>
</span></code></pre></div><h3 id="исключения-spl"><a href="#исключения-spl" class="header-anchor">#</a> Исключения SPL</h3> <p>Универсальный класс <code>Exception</code> предоставляет очень мало отладочного контекста для разработчика; как бы то ни было, для того чтобы исправить это, можно создать специализированный класс, который будет расширять возможности универсального класса <code>Exception</code>:</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">ValidationException</span> <span class="token keyword">extends</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span></code></pre></div><p>Это означает, что вы можете добавить несколько блоков отлова и обрабатывать разные исключения по-разному. Это может привести к созданию <em>множества</em> изменённых Исключений, некоторые из которых можно было бы избежать, используя Исключения SPL, предоставляемые <a href="/#standard_php_library">расширением SPL</a>.</p> <p>Например, если вы используете магический метод <code>__call()</code> и вами был вызван неизвестный метод, то вместо выбрасывания стандартного исключения, которое очень расплывчато, или вместо создания своего исключения, вы можете просто использовать <code>throw new BadFunctionCallException;</code>.</p> <ul><li><a href="http://php.net/manual/ru/language.exceptions.php" target="_blank" rel="noopener noreferrer">Подробнее об Исключениях<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://php.net/manual/ru/spl.exceptions.php" target="_blank" rel="noopener noreferrer">Подробнее о SPL Исключениях<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://www.brandonsavage.net/exceptional-php-nesting-exceptions-in-php/" target="_blank" rel="noopener noreferrer">Вложенные исключения в PHP<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://ralphschindler.com/2010/09/15/exception-best-practices-in-php-5-3" target="_blank" rel="noopener noreferrer">Лучшие практики использования исключений в PHP 5.3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/md/04_dependency_management.html" class="prev">
        Менеджер
      </a></span> <span class="next"><a href="/docs/md/06_db.html">
        Базы данных
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8d616f72.js" defer></script><script src="/assets/js/2.733019b2.js" defer></script><script src="/assets/js/13.402f33c0.js" defer></script>
  </body>
</html>
